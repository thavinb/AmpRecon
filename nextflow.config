// Copyright (C) 2023 Genome Surveillance Unit/Genome Research Ltd.

includeConfig './conf/profiles.config'
includeConfig './conf/modules.config'
includeConfig './conf/containers.config'



// enable dsl2 
nextflow.enable.dsl = 2

params {
    // -------| absolutely required | -----------------------------------
    execution_mode = null                    // .i.e., ["cram", "fastq"]
    batch_id = null                          // user's input identifier for run labeling.
	manifest = null		                     // input samplesheet.

    // --- panel settings ----------------------------------------------------
    panels_settings           = "$projectDir/ampreconresources/plasmodium/falciparum/general/panel_settings_pseudoreference.csv"    

    // ---- GRC setting ------------------------------------------------------
    grc_settings_file_path    = "$projectDir/ampreconresources/plasmodium/falciparum/grc_resources/grc_settings.json"
    chrom_key_file_path       = "$projectDir/ampreconresources/plasmodium/falciparum/grc_resources/chromKey.txt"
    kelch_reference_file_path = "$projectDir/ampreconresources/plasmodium/falciparum/grc_resources/kelchReference.txt"
    drl_information_file_path = "$projectDir/ampreconresources/plasmodium/falciparum/grc_resources/DRLinfo.txt"
    codon_key_file_path       = "$projectDir/ampreconresources/plasmodium/shared/grc_resources/codonKey.txt"
    no_kelch                  = false
    no_plasmepsin             = false

    // -------| params with default values | -----------------------------------
    trace_report_suffix  = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')        // Config options
    results_dir          = "${launchDir}/amprecon_output_${trace_report_suffix}/"     // output directory.
    help                 = false                                                      // boolean for print help message.
    monochrome_logs      = false					                                  // turn off ANSI color, useful when run in envrionment that can't parse ANSI.
	containers_dir       = "containers"
    multiqc_title        = "AmpRecon Statistics"

    // -- McCOIL settings -----------------------------------------------
    mccoil_repopath = "${launchDir}/bin/"
    mccoil_ntotal = 1000                     // total number of iterations steps.
    mccoil_nburnin = 100                     // total number of burnin steps.
    mccoil_seed = 123456                     // random number seed.
    mccoil_maxCOI = 25                       // maximum COI threshold.
    mccoil_maxMissTol = 20                   // the minimum number of non-empty positions threshold for ind/sites.
    mccoil_e1 = 0.05                         // error probability for homo.
    mccoil_e2 = 0.05                         // error probability for het.
    mccoil_m0 = 5                            // initial number for COI guesses.

    // -- BAMADAPTERCLIP -----------------------------------------------
    bamadapterclip_verbose = 1               // set verbose level of bamadapterclip
    bamadapterclip_level = 0				 // set compression level of bamadapterclip 

    // -- BCFTOOLS -----------------------------------------------
    mpileup_min_bq = 20                      // skip bases with baseQ/BAQ smaller than the set value.
    mpileup_max_depth = 50000				 // max per-file depth; avoids excessive memory usage.

    // ---| DEBUG OPTIONS |------------------------------------------------------
    // those parameters are handing modes of executions for dev and testing purposes
    // all of those parameters related behaviours should be removed
    DEBUG_tile_limit = null                  // int (ex: 2), will use "--tile-limit=2" for i2b at basecalls_conversion process
    DEBUG_takes_n_bams = null                // int (ex: 30), will take only X samples from cram_ch in MISEQ_TO_READS
    DEBUG_no_coi = false                     // disable COI

}

manifest {
	name            = 'thavinb/amprecon'
	homePage        = 'https://github.com/thavinb/amprecon'
	description     = """A bioinformatics NextFlow pipeline for generating genetic report cards (GRC) on drug resistance and transmission potential in Plasmodium falciparum and Plasmodium vivax."""
	mainScript      = 'main.nf'
	defaultBranch   = 'master'
	nextflowVersion = '!>=24.04.2'
	version         = 'v1.4.0-GenRe.1'
}

timeline {
    enabled = true
    file    = "${params.results_dir}/pipeline_info/execution_timeline_${params.trace_report_suffix}.html"
}
report {
    enabled = true
    file    = "${params.results_dir}/pipeline_info/execution_report_${params.trace_report_suffix}.html"
}
trace {
    enabled = true
    file    = "${params.results_dir}/pipeline_info/execution_trace_${params.trace_report_suffix}.txt"
}
dag {
    enabled = true
    file    = "${params.results_dir}/pipeline_info/pipeline_dag_${params.trace_report_suffix}.html"
}
